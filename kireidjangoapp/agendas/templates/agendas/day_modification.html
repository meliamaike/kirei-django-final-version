{% extends 'staff/base.html'%}
{% block title %}Modificar agenda por día{% endblock %}
{% block content %}
{% load crispy_forms_tags %}


<div class="card shadow mb-4">
  
  <div class="card-body">
    <div class="row justify-content-sm-center h-100">
      <div class="col-xxl-4 col-xl-5 col-lg-5 col-md-7 col-sm-9">
        <form method="POST" action="" class="needs-validation" autocomplete="off" id= "modification-agenda-form">
          <div class="mb-3">
                {% csrf_token %}
                {{ form|crispy }}
          </div>
          <div class="mb-3">
            <div class="d-flex align-items-center">
                <button id="submit_save_modification" type="submit" class="btn btn-primary ms-auto">
                    Guardar
                </button>
            </div>
          </div>    
      </form>
      </div>
  </div>
  </div>
</div>
  
<script>

  $(function() {
    $('#submit_save_modification').on('click', function(event) {
      event.preventDefault();
      $.ajax({
        url: '{% url "agendas:day_modification" pk=agenda.pk %}',
        type: 'post',
        data: $('#modification-agenda-form').serialize(),
        success: function(data) {
          if (data.success) {
            Swal.fire({
              title: 'Se agregó la modificación exitosamente.',
              icon: 'success',
              confirmButtonText: 'OK'
            }).then((result) => {
              window.location.href = '/agenda/all';
            });
          } else {
            Swal.fire({
              title: 'Error. Ya existe una modificación para este día.',
              text: 'Si desea modificarla, eliminela y vuelva a crear una nueva.',
              icon: 'error',
              showCloseButton: true,
              showConfirmButton: false,
            }).then((result) => {
              if (result.dismiss === Swal.DismissReason.close) {
                window.location.href = '/agenda/all';
              }
            });
          }
        },
        error: function() {
          // If there was a server error, show a generic error message
          Swal.fire({
            title: 'Error',
            text: 'Intente más tarde o comuníquese con el Administrador.',
            icon: 'error',
            showCloseButton: true,
            showConfirmButton: false,
          }).then((result) => {
            if (result.dismiss === Swal.DismissReason.close) {
              window.location.href = '/agenda/all';
            }
          });
        }
      });
    });
  });

  $(document).ready(function() {
    // hide the start_time and end_time fields initially
    $("#div_id_start_time").hide();
    $("#div_id_end_time").hide();
    
    // show or hide the start_time and end_time fields based on the value of the available checkbox
    $("#id_available").change(function() {
      if ($(this).is(":checked")) {
        $("#div_id_start_time").show();
        $("#div_id_end_time").show();
        
      } else {
        $("#div_id_start_time").hide();
        $("#div_id_end_time").hide();
        $("#id_start_time option:selected").val("");
        $("#id_end_time option:selected").val("");
        
      }
    });
  });

  $(document).ready(function() {
      $('.datepicker').datepicker({
          format: 'dd/mm/yyyy',
          autoclose: true,
          todayHighlight: true,
          orientation: 'bottom',
          zIndexOffset: 1000,
      });
  });




</script>


 

 

{% endblock %}